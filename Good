<!DOCTYPE html><html lang="km"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><title>Integral Calculator Pro</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script><script>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="https://unpkg.com/d3@7/dist/d3.min.js"></script><script src="https://unpkg.com/function-plot@1/dist/function-plot.js"></script><style>body{background-color:#0f172a;color:#e2e8f0;font-family:'Outfit','Kantumruy Pro',sans-serif;overflow-x:hidden;-webkit-user-select:none;user-select:none}.glass-panel{background:rgba(30,41,59,0.7);backdrop-filter:blur(20px);border:1px solid rgba(148,163,184,0.1);box-shadow:0 0 40px rgba(0,0,0,0.3)}.input-box{background:#1e293b;border:1px solid #334155;transition:0.3s}.input-box:focus-within{border-color:#38bdf8;box-shadow:0 0 15px rgba(56,189,248,0.2)}.chat-msg{padding:10px 12px;border-radius:12px;margin-bottom:8px;font-size:0.9rem;word-wrap:break-word}.user-msg{background:linear-gradient(135deg,#0ea5e9,#0284c7);color:white;align-self:flex-end;margin-left:20px;border-bottom-right-radius:2px}.bot-msg{background-color:#334155;color:#e2e8f0;align-self:flex-start;margin-right:20px;border-bottom-left-radius:2px;border:1px solid #475569}.shimmer{background:linear-gradient(to right,#1e293b 4%,#334155 25%,#1e293b 36%);background-size:1000px 100%;animation:s 2s infinite linear}@keyframes s{0%{background-position:-1000px 0}100%{background-position:1000px 0}}.dev-glow{color:#fff;text-shadow:0 0 15px #fff,0 0 30px #0ea5e9;animation:n 1.5s infinite alternate;font-weight:800;font-size:1rem;display:inline-block}.typing-indicator span{display:inline-block;width:6px;height:6px;background-color:#94a3b8;border-radius:50%;animation:t 1.4s infinite ease-in-out both;margin:0 2px}.typing-indicator span:nth-child(1){animation-delay:-0.32s}.typing-indicator span:nth-child(2){animation-delay:-0.16s}@keyframes t{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}.lang-btn.active{background-color:#38bdf8!important;color:#0f172a!important;font-weight:bold;box-shadow:0 0 10px rgba(56,189,248,0.5)}</style></head><body class="flex flex-col min-h-screen relative" oncontextmenu="return false;"><nav class="border-b border-slate-800 bg-slate-900/90 sticky top-0 z-50 p-4 flex justify-between items-center backdrop-blur"><div class="flex items-center gap-2"><span class="text-2xl text-sky-400 font-bold">∫</span><div class="font-bold text-lg text-white tracking-wider" id="nav-title">Integral<span class="text-sky-400">Calculator</span></div></div><div class="flex border border-slate-700 rounded-full overflow-hidden text-sm p-1 gap-1"><button class="lang-btn px-4 py-1 rounded-full transition-all duration-300" data-lang="kh" onclick="switchLang('kh')">KH</button><button class="lang-btn px-4 py-1 rounded-full transition-all duration-300" data-lang="en" onclick="switchLang('en')">EN</button></div></nav><main class="flex-grow container mx-auto p-4 max-w-2xl flex flex-col gap-6 py-8 pb-32"><div class="glass-panel rounded-2xl p-6 relative"><div class="flex bg-slate-900 p-1 rounded-lg mb-6 border border-slate-800"><button onclick="setMode('indefinite')" id="tab-indefinite" class="flex-1 py-3 rounded-md text-sm font-bold transition-all"></button><button onclick="setMode('definite')" id="tab-definite" class="flex-1 py-3 rounded-md text-sm font-bold transition-all"></button></div><div class="space-y-5"><div><label class="text-[11px] text-slate-400 font-bold uppercase tracking-widest mb-2 block" id="label-fn"></label><div class="input-box flex items-center rounded-xl px-4 py-4"><span class="text-2xl text-slate-500 font-serif italic mr-3">∫</span><input type="text" id="fn-input" value="sin⁴x" class="bg-transparent w-full text-xl text-white font-bold focus:outline-none placeholder-slate-600" style="font-family:'Outfit',sans-serif"><span class="text-xl text-slate-500 font-serif italic ml-2">dx</span></div></div><div id="limits-row" class="grid grid-cols-2 gap-4 hidden"><div><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" id="label-a"></label><input type="text" id="a-input" value="0" class="input-box w-full rounded-lg p-3 text-center text-white font-mono outline-none"></div><div><label class="text-[10px] text-slate-500 font-bold uppercase mb-1 block" id="label-b"></label><input type="text" id="b-input" value="pi" class="input-box w-full rounded-lg p-3 text-center text-white font-mono outline-none"></div></div><button onclick="solveWithAI()" id="btn-solve" class="w-full bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-500 hover:to-blue-500 py-4 rounded-xl font-bold text-white shadow-lg shadow-sky-900/40 active:scale-[0.98] transition-transform uppercase tracking-widest flex justify-center items-center gap-2"><span id="btn-solve-text"></span></button></div></div><div id="result-card" class="glass-panel rounded-2xl p-6 hidden border-t-2 border-sky-500"><h3 class="text-sky-400 text-xs font-bold tracking-[0.2em] mb-4 uppercase" id="result-header"></h3><div id="loading-skel" class="space-y-4 hidden"><div class="h-4 w-3/4 rounded shimmer"></div><div class="h-4 w-1/2 rounded shimmer"></div><div class="h-24 w-full rounded shimmer"></div></div><div id="ai-content" class="ai-response text-sm md:text-base text-slate-200 overflow-x-auto pb-2"></div><div id="graph-container" class="mt-8 border-t border-slate-700 pt-6"><h4 class="text-xs font-bold text-slate-500 uppercase mb-3" id="graph-header"></h4><div id="graph-area" class="w-full h-[240px] rounded-xl overflow-hidden bg-slate-950/50 border border-slate-800"></div></div></div></main><div id="chat-widget-container" class="fixed bottom-4 left-4 z-[9999] flex flex-col-reverse items-start gap-2"><button onclick="toggleChat()" class="group bg-sky-600 hover:bg-sky-500 text-white w-9 h-9 rounded-full shadow-lg shadow-sky-900/50 flex items-center justify-center transition-all hover:scale-110 active:scale-95 border border-sky-400/30"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.068.157 2.148.279 3.238.364.466.037.893.281 1.153.671L12 21l2.652-3.978c.26-.39.687-.634 1.153-.67 1.09-.086 2.17-.208 3.238-.365 1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/></svg></button><div id="chat-window" class="glass-panel w-[340px] md:w-[380px] h-[500px] rounded-xl flex flex-col hidden shadow-2xl overflow-hidden mb-1 transition-all duration-200 border border-slate-700 origin-bottom-left"><div class="bg-slate-900/90 p-3 border-b border-slate-700 flex justify-between items-center"><div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div><span class="font-bold text-sky-400 text-sm uppercase tracking-wider" id="chat-title"></span></div><button onclick="toggleChat()" class="text-slate-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><div id="chat-messages" class="flex-grow overflow-y-auto p-4 flex flex-col gap-3 scrollbar-thin scrollbar-thumb-slate-700 bg-slate-900/30"><div class="bot-msg chat-msg max-w-[90%] bg-slate-700/50 text-slate-300 text-xs text-center mx-auto mb-2"><span id="chat-welcome"></span></div></div><div class="p-3 bg-slate-900/90 border-t border-slate-700"><div class="flex gap-2"><input type="text" id="chat-input" class="bg-slate-800 border border-slate-700 text-white text-sm rounded-lg block w-full p-2.5 focus:border-sky-500 focus:outline-none" placeholder="..."><button onclick="sendChatMessage()" id="btn-chat-send" class="bg-sky-600 hover:bg-sky-500 text-white rounded-lg px-3 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"/></svg></button></div></div></div></div><footer class="text-center py-8 text-[10px] text-slate-600 uppercase tracking-widest"><span id="footer-dev-text"></span></footer><script>const _SVR="https://smart-sinh-1.onrender.com";document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=e=>{if(e.keyCode==123||(e.ctrlKey&&e.shiftKey&&(e.keyCode==73||e.keyCode==74))||(e.ctrlKey&&e.keyCode==85))return!1};const _md=window.markdownit();let _m='indefinite',_l=localStorage.getItem('app_lang')||'kh',_ch=[],_fr=null,_ic=!1;if(_l==='km')_l='kh';const _T={kh:{ti:'មិនកំណត់',td:'កំណត់',lf:'អនុគមន៍ f(x)',la:'ពី (a)',lb:'ទៅ (b)',bs:'ដោះស្រាយ',rh:'ចម្លើយ',gh:'ក្រាហ្វនៃអនុគមន៍',fd:'បង្កើតដោយ',dn:'ឈៀង ស៊ិញស៊ិញ',ct:'ជំនួយការគណិត (Math Helper)',cw:'សួស្តី! មានលំហាត់អ្វីឱ្យខ្ញុំជួយទេ?',cp:'សួរខ្ញុំ...',cm:'⚡ បង្ហាញពី Cache (មិនប្រើអ៊ីនធឺណិត)',pr:'You are an expert Math Professor.',pt:'Solve integral. IMPORTANT: Explain in TWO languages. First KHMER. Then separator "||||". Then ENGLISH. Use LaTeX.',cpr:'You are Math Assistant communicating in Khmer. Creator: "CHHEANG SINHSINH".',ep:'⚠️ បរាជ័យក្នុងការដោះស្រាយ (Server Error):'},en:{ti:'Indefinite',td:'Definite',lf:'Function f(x)',la:'From (a)',lb:'To (b)',bs:'Solve',rh:'Result',gh:'Graph of the Function',fd:'Created by',dn:'CHHEANG SINHSINH',ct:'Math Assistant',cw:'Hello! Need help?',cp:'Ask me...',cm:'⚡ Loaded from Cache',pr:'You are an expert Math Professor.',pt:'Solve integral. IMPORTANT: Explain in TWO languages. First KHMER. Then separator "||||". Then ENGLISH. Use LaTeX.',cpr:'You are Math Assistant communicating in English. Creator: "CHHEANG SINHSINH".',ep:'⚠️ Solve Failed (Server Error):'}};window.normalizeInput=s=>{const m={'⁰':'0','¹':'1','²':'2','³':'3','⁴':'4','⁵':'5','⁶':'6','⁷':'7','⁸':'8','⁹':'9'};return s.split('').map(c=>m[c]?`^${m[c]}`:c).join('')};window.updateUI=()=>{const t=_T[_l];document.getElementById('tab-indefinite').textContent=t.ti;document.getElementById('tab-definite').textContent=t.td;document.getElementById('label-fn').textContent=t.lf;document.getElementById('label-a').textContent=t.la;document.getElementById('label-b').textContent=t.lb;document.getElementById('btn-solve-text').textContent=t.bs;document.getElementById('result-header').textContent=t.rh;document.getElementById('graph-header').textContent=t.gh;document.getElementById('footer-dev-text').innerHTML=`${t.fd} <span class="dev-glow">${t.dn}</span>`;document.getElementById('chat-title').textContent=t.ct;document.getElementById('chat-welcome').textContent=t.cw;document.getElementById('chat-input').placeholder=t.cp;document.querySelectorAll('.lang-btn').forEach(b=>{b.classList.remove('active','text-slate-200');if(b.dataset.lang===_l)b.classList.add('active');else b.classList.add('text-slate-200')});window.setMode(_m,!0)};window.switchLang=l=>{if(_l===l)return;_l=l;localStorage.setItem('app_lang',l);window.updateUI();if(_fr)_rD(_fr,_ic)};window.setMode=(m,u=!1)=>{_m=m;const r=document.getElementById('limits-row'),t1=document.getElementById('tab-indefinite'),t2=document.getElementById('tab-definite'),a="flex-1 py-3 rounded-md text-sm font-bold bg-sky-500/10 text-sky-400 border border-sky-500/30 transition-all",i="flex-1 py-3 rounded-md text-sm font-bold text-slate-500 hover:text-white transition-all";if(m==='definite'){r.classList.remove('hidden');r.classList.add('grid');t2.className=a;t1.className=i}else{r.classList.add('hidden');r.classList.remove('grid');t1.className=a;t2.className=i}};function _gC(f,a,b,m){return `cc_v5_S_${m}_${f.replace(/\s/g,'').toLowerCase()}_${a}_${b}`}function _rD(txt,isc){const c=document.getElementById('ai-content'),p=txt.split('||||'),ts=_l==='kh'?p[0]:(p[1]||p[0]);c.innerHTML=(isc?`<div class="text-[10px] text-green-400 mb-3 bg-green-500/10 inline-block px-2 py-1 rounded border border-green-500/20 font-mono tracking-wider">${_T[_l].cm}</div>`:'')+_md.render(ts);if(window.MathJax)MathJax.typesetPromise([c])}window.solveWithAI=async()=>{const f=window.normalizeInput(document.getElementById('fn-input').value),a=document.getElementById('a-input').value,b=document.getElementById('b-input').value,btn=document.getElementById('btn-solve'),rc=document.getElementById('result-card'),ld=document.getElementById('loading-skel'),ct=document.getElementById('ai-content'),t=_T[_l],ck=_gC(f,_m==='definite'?a:'N/A',_m==='definite'?b:'N/A',_m);btn.disabled=!0;btn.innerHTML=`<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> ${t.bs}`;rc.classList.remove('hidden');ld.classList.remove('hidden');ct.innerHTML="";document.getElementById('graph-container').classList.add('hidden');try{const cd=localStorage.getItem(ck);if(cd){await new Promise(r=>setTimeout(r,400));_fr=cd;_ic=!0;_rD(cd,!0);window.drawGraph(f,_m==='definite'?a:-5,_m==='definite'?b:5,_m==='definite');document.getElementById('graph-container').classList.remove('hidden');ld.classList.add('hidden');btn.disabled=!1;btn.innerHTML=`<span id="btn-solve-text">${t.bs}</span>`;return}const pt=_m==='indefinite'?`Solve indefinite: (${f}) dx. ${t.pt}`:`Solve definite: (${f}) dx from ${a} to ${b}. ${t.pt}`;const rsp=await fetch(`${_SVR}/api/solve`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:pt,systemInstruction:t.pr})});if(!rsp.ok)throw new Error("Server Error");const d=await rsp.json();if(d.text){_fr=d.text;_ic=!1;_rD(d.text,!1);try{localStorage.setItem(ck,d.text)}catch(e){}window.drawGraph(f,_m==='definite'?a:-5,_m==='definite'?b:5,_m==='definite');document.getElementById('graph-container').classList.remove('hidden')}else throw new Error("Empty")}catch(e){ct.innerHTML=`<div class="text-red-400 bg-red-900/20 p-4 rounded-lg border border-red-500/50"><strong>${t.ep}</strong> ${e.message}</div>`}finally{ld.classList.add('hidden');btn.disabled=!1;btn.innerHTML=`<span id="btn-solve-text">${t.bs}</span>`}};window.drawGraph=(e,mn,mx,id)=>{try{e=window.normalizeInput(e);let n=parseFloat(mn)||-10,x=parseFloat(mx)||10;if(mn.toString().includes('pi'))n=-3.14;if(mx.toString().includes('pi'))x=3.14;if(Math.abs(n)>50)n=-10;if(Math.abs(x)>50)x=10;functionPlot({target:'#graph-area',width:document.getElementById('graph-area').clientWidth,height:240,yAxis:{domain:[-4,4]},xAxis:{domain:[n-1,x+1]},grid:!0,theme:'dark',data:[{fn:e.toLowerCase().replace(/ln/g,'log'),color:'#38bdf8',closed:id,range:id?[n,x]:[-10,10],skipTip:!0}]})}catch(err){document.getElementById('graph-container').classList.add('hidden')}};window.toggleChat=()=>document.getElementById('chat-window').classList.toggle('hidden');window.sendChatMessage=async()=>{const i=document.getElementById('chat-input'),m=i.value.trim();if(!m)return;const c=document.getElementById('chat-messages'),ud=document.createElement('div');ud.className='user-msg chat-msg';ud.textContent=m;c.appendChild(ud);i.value='';c.scrollTop=c.scrollHeight;const ld=document.createElement('div');ld.className='bot-msg chat-msg bg-transparent border-0 p-0';ld.innerHTML=`<div class="typing-indicator bg-slate-800 p-3 rounded-xl border border-slate-700 inline-block"><span></span><span></span><span></span></div>`;c.appendChild(ld);c.scrollTop=c.scrollHeight;_ch.push({role:"user",parts:[{text:m}]});try{const rsp=await fetch(`${_SVR}/api/chat`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:m,history:_ch.map(v=>({role:v.role,parts:v.parts.map(p=>({text:p.text}))})),systemInstruction:_T[_l].cpr})});if(!rsp.ok)throw new Error;const d=await rsp.json();ld.remove();if(d.text){const bd=document.createElement('div');bd.className='bot-msg chat-msg';bd.innerHTML=_md.render(d.text);c.appendChild(bd);_ch.push({role:"model",parts:[{text:d.text}]});if(window.MathJax)MathJax.typesetPromise([bd]);c.scrollTop=c.scrollHeight}}catch(e){ld.innerHTML=`<span class="text-red-400 bg-red-900/20 px-2 py-1 rounded">Error</span>`}};document.getElementById('chat-input').addEventListener('keypress',e=>{if(e.key==='Enter')window.sendChatMessage()});document.addEventListener('DOMContentLoaded',()=>{window.updateUI()});</script></body></html>
